# SAPDat
Поиск опасных уровней доступа( привилегий) SAP системы
На вход принимается имя excel файла 
Создаваёт в этом файле новую вкладку (Security)
Копирует туда записи из первой вкладки, при этом:
·       Необходимо оставить только поля AGR_NAME (имя роли), OBJECT (имя объекта авторизации), AUTH(имя авторизации), FIELD(поле объекта авторизации), LOW(Значение), HIGH(Для простоты пока не рассматриваем)
·       Записи с X в поле DELETED не рассматриваются (не копируются)
·       Строки сортируются по следующим полям: AGR_NAME, OBJECT, AUTH (аналогично SQL запросу)
·       Критичные привелегии ведяются красным, а номер авторизации с которым она пришла(вместе с другими привелегиями) жёлтым (об этом чуть ниже)
·       Добавляет поле(колонку) Критичные привилегии (Возможные значения Да/Нет)
·      

Теперь про то, что есть критичные привилегии:
 
Есть объект авторизации, например, S_TCODE (OBJECT), у него одно поле TCD (FIELD), и в это поле можно написать значение (LOW) (одно или несколько-тогда будет несколько строчек)
Есть объект авторизации, например, S_TABU_DIS, У него два поля, DICBERCLS и ACTVT, в каждое из этих полей можно что-то написать.
Есть объект авторизации, например, S_DEVELOP, У него 5ть полей, два из которых ACTVT, OBJTYPE, в каждое их этих полей можно что-то написать.
 
Важное замечание: У конкретного объекта авторизации составной ключ в этой таблице: AGR_NAME, OBJECT, AUTH.
Т.е: AGR_NAME, OBJECT, AUTH:
              ROLE1, S_TABU_DIS, T-5556
              ROLE1, S_TABU_DIS, T-5557
Это два разных объекта авторизации!!!
 
Список критичных полномочий задается файлом настройки. В него входят например:
S_TCODE:TCD=SE37
S_TCODE:TCD=SA38
S_DEVELOP:ACTVT=02 и при этом :OBJTYPE=DEBUG (в одном объекте авторизации)
S_TABU_DIS:ACTVT=03 и при этом :DICBERCLS=* (в одном объекте авторизации)
 
Учесть, что в поле LOW может быть * тоже (значит что назначаются все привилегии).
 
 
Итого, пример:
ROLE1, S_TCODE, T-5556, TCD, SM30 - не критичный объект, не подсвечиваем
ROLE1, S_TCODE, T-5557, TCD, SE37 - критичный объект, подсвечиваем (есть в списке критичных привилегий)
ROLE1, S_TABU_DIS, T-5557, ACTVT, 03 в совокупности со следующей строкой не критичный объект, т.к. в поле DICBERCLS не *
ROLE1, S_TABU_DIS, T-5557, DICBERCLS, PC
ROLE1, S_TABU_DIS, T-5558, ACTVT, 02 в совокупности со следующей строкой не критичный объект, т.к. в поле ACTVT не 03
ROLE1, S_TABU_DIS, T-5558, DICBERCLS, *
ROLE1, S_TABU_DIS, T-5559, ACTVT, 03 критичный, подсвечиваем красным
ROLE1, S_TABU_DIS, T-5559, DICBERCLS, *
ROLE1, S_DEVEOP, T-5560, ACTVT, 02   критичный объект т.к. поле OBJTYPE задано *, т.о. значений DEBUG (указанное в настройках) в него попадает
ROLE1, S_DEVELOP, T-5560, OBJTYPE, *
ROLE1, S_TABU_DIS, T-5561, ACTVT, 03 Это разные объекты авторизации, необходимые условия чтобы поместить данный объект как критичный не выполнены.
ROLE1, S_TABU_DIS, T-5562, DICBERCLS, *
 
